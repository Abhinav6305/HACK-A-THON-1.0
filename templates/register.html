<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - HACK-A-THON 1.0</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/loader.css') }}">
</head>
<body>
    <nav>
        <div class="nav-container">
            <div class="logo">
                <a href="{{ url_for('static', filename='logo/Untitled design (1).png') }}" target="_blank">
                    <img src="{{ url_for('static', filename='logo/Untitled design (1).png') }}" alt="Logo">
                </a>
                <a href="{{ url_for('home') }}">
                    <img src="{{ url_for('static', filename='logo/ORIGIN LOGO.jpg') }}" alt="Logo">
                </a>
            </div>
            <ul>
                <li><a href="{{ url_for('home') }}">Home</a></li>
            </ul>
        </div>
    </nav>

    <section class="register-form fade-in-up">
        <h2>Team Registration</h2>
        <form id="registrationForm" action="{{ url_for('register') }}" method="post" enctype="multipart/form-data">
            <!-- Step 1 -->
            <div class="form-step active" id="step1">
                <div class="form-container">
                    <div class="form-group"><label>Team Name</label><input type="text" name="team_name" required></div>
                    <div class="form-group"><label>Team Lead</label><input type="text" name="leader_name" required></div>
                    <div class="form-group"><label>Team Lead Email</label><input type="email" name="leader_email" required></div>
                    <div class="form-group"><label>Leader Phone</label><input type="tel" name="leader_phone" required></div>
                    <div class="form-group"><label>College/School</label><input type="text" name="leader_company" required></div>
                </div>
            </div>

            <!-- Step 2 -->
            <div class="form-step" id="step2">
                <div class="form-container">
                    <div class="form-group team-size-group">
                        <label>Team Size</label>
                        <div class="team-size-options">
                            <button type="button" class="team-size-btn" data-size="3">3</button>
                            <button type="button" class="team-size-btn" data-size="4">4</button>
                            <button type="button" class="team-size-btn" data-size="5">5</button>
                        </div>
                        <input type="hidden" id="team_size" name="team_size" required>
                    </div>
                    <div id="memberFields"></div>
                </div>
            </div>

            <!-- Step 3 -->
            <div class="form-step" id="step3">
                <div class="form-container">
                    <div class="form-group"><label>Abstract (PDF, max 10MB)</label><input type="file" name="abstract" accept=".pdf" required></div>
                </div>
            </div>

            <!-- Step 4 -->
            <div class="form-step" id="step4">
                <div class="form-container payment-step">
                    <h3>Payment</h3>
                    <p>Registration fee: ₹99 per team</p>
                    <div class="qr-box">
                        <img src="{{ url_for('static', filename='scanner/GooglePay_QR.png') }}" alt="QR">
                        <p>Scan & Pay</p>
                        <p>Path Test: {{ url_for('static', filename='scanner/GooglePay_QR.png') }}</p>
                    </div>
                    <div class="form-group"><label>Transaction ID</label><input type="text" name="transaction_id" required></div>
                    <div class="form-group"><label>Upload Payment Screenshot</label><input type="file" name="transaction_photo" accept="image/*" required></div>
                    <div class="form-group agree">
                        <label><input type="checkbox" name="agree_terms" required> I agree to the <a href="#terms">Terms & Conditions</a></label>
                    </div>
                </div>
            </div>

            <div class="form-navigation">
                <button type="button" id="prevBtn" class="nav-btn">← Previous</button>
                <button type="button" id="nextBtn" class="nav-btn">Next →</button>
            </div>
        </form>
    </section>

    <!-- Loader -->
    <div id="loader" class="loader">
        <div class="spinner"></div>
        <p>Please wait while your abstract is being evaluated and the registration is in process</p>
    </div>

    <script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
    <script>
        window.onload = () => {
            document.getElementById('loader').classList.remove('show');
        };
        /* === Multi-step Form Controller === */
        let step = 1; const steps = document.querySelectorAll('.form-step');
        const nextBtn = document.getElementById('nextBtn'); const prevBtn = document.getElementById('prevBtn');
        const form = document.getElementById('registrationForm');
        const teamSizeSelect = document.getElementById('team_size'); const memberFields = document.getElementById('memberFields');



        function genMembers(size){
            memberFields.innerHTML='';
            for(let i=1;i<size;i++){
                memberFields.innerHTML+=`
                <div class="member-block fade-in-up">
                    <div class="form-group"><label>Member ${i} Name</label><input type="text" name="member_${i}_name" required></div>
                    <div class="form-group"><label>Member ${i} Email</label><input type="email" name="member_${i}_email" required></div>
                    <div class="form-group"><label>Member ${i} Phone</label><input type="tel" name="member_${i}_phone" required></div>
                    <div class="form-group"><label>College/School</label><input type="text" name="member_${i}_company" required></div>
                </div>`;}
        }
        genMembers(3);

        // Team size button selection
        const teamSizeBtns = document.querySelectorAll('.team-size-btn');
        teamSizeBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                teamSizeBtns.forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                const size = btn.getAttribute('data-size');
                document.getElementById('team_size').value = size;
                genMembers(parseInt(size));
            });
        });

        function showStep(n){
            steps.forEach(s=>s.classList.remove('active'));
            steps[n-1].classList.add('active');
            prevBtn.style.display=n>1?'block':'none';
            nextBtn.textContent=n===steps.length?'Submit':'Next →';
        }
        nextBtn.onclick=(e)=>{
            e.preventDefault();
            if(step<steps.length){
                if(validate(step)){
                    step++;showStep(step);
                }
            } else {
                if(validate(step)){
                    document.getElementById('loader').classList.add('show');
                    // Use AJAX to submit form and redirect to success page
                    const formData = new FormData(form);
                    fetch('{{ url_for("register") }}', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => {
                        if (response.ok) {
                            window.location.href = '{{ url_for("registration_success") }}';
                        } else {
                            document.getElementById('loader').classList.remove('show');
                            alert('Registration failed. Please try again.');
                        }
                    })
                    .catch(error => {
                        document.getElementById('loader').classList.remove('show');
                        alert('An error occurred. Please try again.');
                    });
                }
            }
        };
        prevBtn.onclick=()=>{if(step>1){step--;showStep(step);}};

        function validate(n){
            const current=steps[n-1];
            let valid=true;
            current.querySelectorAll('input[required],select[required]').forEach(inp=>{
                inp.style.borderColor=inp.value.trim()?'#fff':'#f00';
                if(!inp.value.trim()) valid=false;
            });
            return valid;
        }
        showStep(step);
    </script>
</body>
</html>
